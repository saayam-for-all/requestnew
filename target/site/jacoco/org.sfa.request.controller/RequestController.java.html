<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RequestController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">request</a> &gt; <a href="index.source.html" class="el_package">org.sfa.request.controller</a> &gt; <span class="el_source">RequestController.java</span></div><h1>RequestController.java</h1><pre class="source lang-java linenums">package org.sfa.request.controller;

import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.media.Content;
import io.swagger.v3.oas.annotations.media.ExampleObject;
import io.swagger.v3.oas.annotations.media.Schema;
import io.swagger.v3.oas.annotations.responses.ApiResponse;
import io.swagger.v3.oas.annotations.responses.ApiResponses;
import io.swagger.v3.oas.annotations.tags.Tag;
import org.sfa.request.response.PagedResponse;
import org.sfa.request.model.entity.Request;
import org.sfa.request.dto.RequestDTO;
import org.sfa.request.service.api.RequestService;
import org.sfa.request.response.SaayamResponse;
import lombok.RequiredArgsConstructor;
import org.springframework.data.domain.Pageable;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import jakarta.validation.Valid;
import jakarta.validation.constraints.NotNull;
import org.springframework.web.servlet.LocaleResolver;

import jakarta.servlet.http.HttpServletRequest;
import java.util.Locale;

/**
 * ClassName: RequestController
 * Package: org.sfa.request.controller
 * Description:
 *
 * @author Fan Peng
 * Create 2024/6/15 1:51
 * @version 1.0
 */
@Validated
@RestController
@RequestMapping(&quot;/api/v1.0.0/requests/{requesterId}&quot;)
<span class="fc" id="L41">@RequiredArgsConstructor</span>
@Tag(name = &quot;Request&quot;, description = &quot;Request management APIs&quot;)
public class RequestController {

    private final RequestService requestService;
    private final LocaleResolver localeResolver;

    @Operation(
            summary = &quot;Create a new request&quot;,
            description = &quot;Creates a new request in the Saayam system for the specified requester. &quot; +
                    &quot;The request includes details such as priority, type, category, and description.&quot;
    )
    @ApiResponses(value = {
            @ApiResponse(
                    responseCode = &quot;201&quot;,
                    description = &quot;Request successfully created&quot;,
                    content = @Content(
                            mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = SaayamResponse.class),
                            examples = @ExampleObject(
                                    value = &quot;&quot;&quot;
                {
                  &quot;success&quot;: true,
                  &quot;statusCode&quot;: 201,
                  &quot;saayamCode&quot;: &quot;SAAAYAM-1201&quot;,
                  &quot;message&quot;: &quot;Request REQ-00-000-000-0017 has been successfully created and saved in the system&quot;,
                  &quot;data&quot;: {
                    &quot;requestId&quot;: &quot;REQ-00-000-000-0017&quot;,
                    &quot;requesterId&quot;: &quot;SID-00-000-000-0001&quot;,
                    &quot;requestStatus&quot;: {
                      &quot;requestStatusId&quot;: 1,
                      &quot;status&quot;: &quot;CREATED&quot;,
                      &quot;description&quot;: &quot;Request has been created&quot;,
                      &quot;lastUpdatedAt&quot;: &quot;2024-07-15T19:37:44.653792Z&quot;
                    },
                    &quot;requestPriority&quot;: {
                      &quot;priorityId&quot;: 1,
                      &quot;priority&quot;: &quot;LOW&quot;,
                      &quot;description&quot;: &quot;Low priority&quot;,
                      &quot;lastUpdatedAt&quot;: &quot;2024-07-15T19:37:44.65499Z&quot;
                    },
                    &quot;requestType&quot;: {
                      &quot;requestTypeId&quot;: 1,
                      &quot;type&quot;: &quot;IN_PERSON&quot;,
                      &quot;description&quot;: &quot;In-person request&quot;,
                      &quot;lastUpdatedAt&quot;: &quot;2024-07-15T19:37:44.65581Z&quot;
                    },
                    &quot;requestCategory&quot;: {
                      &quot;requestCategoryId&quot;: 1,
                      &quot;category&quot;: &quot;TECHNICAL_SUPPORT&quot;,
                      &quot;description&quot;: &quot;Technical support request&quot;,
                      &quot;lastUpdatedAt&quot;: &quot;2024-07-15T19:37:44.656694Z&quot;
                    },
                    &quot;requestFor&quot;: {
                      &quot;requestForId&quot;: 1,
                      &quot;description&quot;: &quot;Request for self&quot;,
                      &quot;lastUpdatedAt&quot;: &quot;2024-07-15T19:37:44.657513Z&quot;,
                      &quot;for&quot;: &quot;SELF&quot;
                    },
                    &quot;city&quot;: &quot;MD&quot;,
                    &quot;zipCode&quot;: &quot;2288&quot;,
                    &quot;requestDescription&quot;: &quot;Need technical support&quot;,
                    &quot;audioRequestDescription&quot;: &quot;Audio description of the request&quot;,
                    &quot;submittedAt&quot;: &quot;2024-07-16T23:03:21.4388422-04:00&quot;,
                    &quot;leadVolunteerUserId&quot;: 123,
                    &quot;servicedAt&quot;: null,
                    &quot;lastUpdatedAt&quot;: &quot;2024-07-16T23:03:21.4388422-04:00&quot;
                  },
                  &quot;timestamp&quot;: &quot;2024-07-16T23:03:21.471842-04:00&quot;
                }
                &quot;&quot;&quot;
                            )
                    )
            ),
            @ApiResponse(
                    responseCode = &quot;400&quot;,
                    description = &quot;Invalid input&quot;,
                    content = @Content(
                            mediaType = &quot;application/json&quot;,
                            schema = @Schema(implementation = SaayamResponse.class),
                            examples = @ExampleObject(
                                    value = &quot;&quot;&quot;
                {
                  &quot;success&quot;: false,
                  &quot;statusCode&quot;: 400,
                  &quot;saayamCode&quot;: &quot;SAAAYAM-1413&quot;,
                  &quot;message&quot;: &quot;Invalid value: Unspecified or null value is not allowed for RequestPriority. Please provide a valid option&quot;,
                  &quot;timestamp&quot;: &quot;2024-07-17T19:02:55.2930539-04:00&quot;
                }
                &quot;&quot;&quot;
                            )
                    )
            )
    })
    @PostMapping
    public ResponseEntity&lt;SaayamResponse&lt;Request&gt;&gt; createRequest(
            @Parameter(description = &quot;Unique identifier of the requester&quot;, required = true, example = &quot;SID-00-000-000-0001&quot;)
            @PathVariable @NotNull String requesterId,

            @Parameter(description = &quot;Request details&quot;, required = true)
            @RequestBody @Valid RequestDTO requestDTO,

            HttpServletRequest request
    ) {
<span class="nc" id="L145">        requestDTO.setRequesterId(requesterId);</span>
<span class="nc" id="L146">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="nc" id="L147">        SaayamResponse&lt;Request&gt; response = requestService.createRequest(requesterId, requestDTO, locale);</span>
<span class="nc" id="L148">        return ResponseEntity.status(HttpStatus.CREATED).body(response);</span>
    }

    @GetMapping(&quot;/{requestId}&quot;)
    public ResponseEntity&lt;SaayamResponse&lt;Request&gt;&gt; getRequestById(
            @PathVariable @NotNull String requesterId,
            @PathVariable @NotNull String requestId,
            HttpServletRequest request
    ) {
<span class="fc" id="L157">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="fc" id="L158">        SaayamResponse&lt;Request&gt; response = requestService.getRequestById(requesterId, requestId, locale);</span>
<span class="fc" id="L159">        return ResponseEntity.ok(response);</span>
    }

    @GetMapping
    public ResponseEntity&lt;SaayamResponse&lt;PagedResponse&lt;Request&gt;&gt;&gt; getRequests(
            @PathVariable @NotNull String requesterId,
            Pageable pageable,
            HttpServletRequest request
    ) {
<span class="nc" id="L168">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="nc" id="L169">        SaayamResponse&lt;PagedResponse&lt;Request&gt;&gt; response = requestService.getRequests(requesterId, pageable, locale);</span>
<span class="nc" id="L170">        return ResponseEntity.ok(response);</span>
    }

    @PutMapping(&quot;/{requestId}&quot;)
    public ResponseEntity&lt;SaayamResponse&lt;Request&gt;&gt; updateRequest(
            @PathVariable @NotNull String requesterId,
            @PathVariable @NotNull String requestId,
            @RequestBody @Valid RequestDTO requestDTO,
            HttpServletRequest request
    ) {
<span class="nc" id="L180">        requestDTO.setRequesterId(requesterId);</span>
<span class="nc" id="L181">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="nc" id="L182">        SaayamResponse&lt;Request&gt; response = requestService.updateRequest(requesterId, requestId, requestDTO, locale);</span>
<span class="nc" id="L183">        return ResponseEntity.ok(response);</span>
    }

    @DeleteMapping(&quot;/{requestId}&quot;)
    public ResponseEntity&lt;SaayamResponse&lt;Void&gt;&gt; deleteRequest(
            @PathVariable @NotNull String requesterId,
            @PathVariable @NotNull String requestId,
            HttpServletRequest request
    ) {
<span class="fc" id="L192">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="fc" id="L193">        SaayamResponse&lt;Void&gt; response = requestService.deleteRequest(requesterId, requestId, locale);</span>
<span class="fc" id="L194">        return ResponseEntity.ok(response);</span>
    }

    @PostMapping(&quot;/{requestId}/cancel&quot;)
    public ResponseEntity&lt;SaayamResponse&lt;Request&gt;&gt; cancelRequest(
            @PathVariable @NotNull String requesterId,
            @PathVariable @NotNull String requestId,
            HttpServletRequest request
    ) {
<span class="fc" id="L203">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="fc" id="L204">        SaayamResponse&lt;Request&gt; response = requestService.cancelRequest(requesterId, requestId, locale);</span>
<span class="fc" id="L205">        return ResponseEntity.ok(response);</span>
    }

    @PostMapping(&quot;/{requestId}/resume&quot;)
    public ResponseEntity&lt;SaayamResponse&lt;Request&gt;&gt; resumeRequest(
            @PathVariable @NotNull String requesterId,
            @PathVariable @NotNull String requestId,
            HttpServletRequest request
    ) {
<span class="fc" id="L214">        Locale locale = localeResolver.resolveLocale(request);</span>
<span class="fc" id="L215">        SaayamResponse&lt;Request&gt; response = requestService.resumeRequest(requesterId, requestId, locale);</span>
<span class="fc" id="L216">        return ResponseEntity.ok(response);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>